import{_ as e}from"./plugin-vue_export-helper.21dcd24c.js";import{o as p,c as o,a as s,b as l,e as a,d as n,r as c}from"./app.09d9ce72.js";const i={},u=a(`<h1 id="spring-cloud-ribbon" tabindex="-1"><a class="header-anchor" href="#spring-cloud-ribbon" aria-hidden="true">#</a> Spring Cloud Ribbon</h1><p>Spring Cloud Ribbon \u662F\u57FA\u4E8EHTTP\u548CTCP\u7684\u5BA2\u6237\u7AEF\u8D1F\u8F7D\u5747\u8861\u5DE5\u5177\uFF0C\u57FA\u4E8ENetflix Ribbon\u5B9E\u73B0\u3002Spring Cloud Ribbon \u4F1A<strong>\u5C06REST\u8BF7\u6C42\u8F6C\u6362\u4E3A\u5BA2\u6237\u7AEF\u8D1F\u8F7D\u5747\u8861\u7684\u670D\u52A1\u8C03\u7528</strong>\u3002</p><p>\u5728\u5BA2\u6237\u7AEF\u8282\u70B9\u4F1A\u7EF4\u62A4\u53EF\u8BBF\u95EE\u7684\u670D\u52A1\u5668\u6E05\u5355\uFF0C\u670D\u52A1\u5668\u6E05\u5355\u6765\u81EA\u670D\u52A1\u6CE8\u518C\u4E2D\u5FC3\uFF0C\u901A\u8FC7\u5FC3\u8DF3\u7EF4\u6301\u670D\u52A1\u5668\u6E05\u5355\u7684\u5065\u5EB7\u6027\u3002</p><p>\u5F00\u542F\u5BA2\u6237\u7AEF\u8D1F\u8F7D\u5747\u8861\u8C03\u7528\uFF1A</p><ol><li>\u670D\u52A1\u63D0\u4F9B\u8005\u542F\u52A8\u591A\u4E2A\u670D\u52A1\u5B9E\u4F8B\u6CE8\u518C\u5230\u670D\u52A1\u6CE8\u518C\u4E2D\u5FC3\uFF1B</li><li>\u670D\u52A1\u6D88\u8D39\u8005\u76F4\u63A5\u901A\u8FC7\u8C03\u7528\u88AB@LoadBalanced \u6CE8\u89E3\u4FEE\u9970\u8FC7\u7684RestTemplate \u6765\u5B9E\u73B0\u9762\u5411\u670D\u52A1\u7684\u63A5\u53E3\u8C03\u7528\u3002</li></ol><h2 id="resttemplate" tabindex="-1"><a class="header-anchor" href="#resttemplate" aria-hidden="true">#</a> RestTemplate</h2><p>RestTemplate\u662F\u4E00\u4E2AHTTP\u5BA2\u6237\u7AEF\uFF0C\u4F7F\u7528\u5B83\u6211\u4EEC\u53EF\u4EE5\u65B9\u4FBF\u7684\u8C03\u7528HTTP\u63A5\u53E3\uFF0C\u652F\u6301GET\u3001POST\u3001PUT\u3001DELETE\u7B49\u65B9\u6CD5\u3002</p><h2 id="\u4EE3\u7801\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u4EE3\u7801\u5B9E\u4F8B" aria-hidden="true">#</a> \u4EE3\u7801\u5B9E\u4F8B</h2><p>\u521B\u5EFAhello-service\u6A21\u5757\uFF0C\u7528\u4E8E\u7ED9 Ribbon \u63D0\u4F9B\u670D\u52A1\u8C03\u7528\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">Registration</span> registration<span class="token punctuation">;</span>  <span class="token comment">// \u670D\u52A1\u6CE8\u518C</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> client<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> LOGGER <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">HelloController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServiceInstance</span> instance <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span>registration<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;/hello, host:&quot;</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, service_id:&quot;</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6DFB\u52A0\u76F8\u5173\u7684\u4F9D\u8D56\uFF1A</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u914D\u7F6E\u7AEF\u53E3\u548C\u6CE8\u518C\u4E2D\u5FC3\u5730\u5740\uFF1A</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">hello-service</span>
<span class="token key attr-name">eureka.client.serviceUrl.defaultZone</span><span class="token punctuation">=</span><span class="token value attr-value">http://localhost:8002/eureka/, http://localhost:8003/eureka/</span>
<span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">8081</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521B\u5EFAribbon-consumer\u6A21\u5757\uFF0C\u4F7F\u7528\u8D1F\u8F7D\u5747\u8861\u8C03\u7528hello-service\u670D\u52A1\u3002</p><p>\u6DFB\u52A0\u76F8\u5173\u4F9D\u8D56\uFF1A</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-ribbon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u914D\u7F6E\u4E86\u7AEF\u53E3\u3001\u6CE8\u518C\u4E2D\u5FC3\u5730\u5740\u3002</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token value attr-value">ribbon-consumer</span>
<span class="token key attr-name">server.port</span><span class="token punctuation">=</span><span class="token value attr-value">9000</span>
<span class="token key attr-name">eureka.client.serviceUrl.defaultZone</span><span class="token punctuation">=</span><span class="token value attr-value">http://localhost:8002/eureka/, http://localhost:8002/eureka/</span>
<span class="token key attr-name">hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds</span><span class="token punctuation">=</span><span class="token value attr-value">2000</span>
<span class="token key attr-name">service-url.hello-service</span> <span class="token punctuation">=</span> <span class="token value attr-value">http://HELLO-SERVICE</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528@LoadBalanced\u6CE8\u89E3\u8D4B\u4E88RestTemplate\u8D1F\u8F7D\u5747\u8861\u7684\u80FD\u529B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RibbonConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521B\u5EFAConsumerController\uFF0C\u6CE8\u5165RestTemplate\uFF0C\u4F7F\u7528\u5176\u8C03\u7528hello-service\u4E2D\u63D0\u4F9B\u7684\u76F8\u5173\u63A5\u53E3\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${service-url.hello-service}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> helloService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/ribbon-consumer&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">helloConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span>helloService <span class="token operator">+</span> <span class="token string">&quot;/hello&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,23),r=n("\u542F\u52A8\u4E24\u4E2A hello-service \u5B9E\u4F8B\uFF088001/8002\uFF09\uFF0C\u8C03\u7528\u63A5\u53E3 "),k={href:"http://localhost:9000/ribbon-consumer",target:"_blank",rel:"noopener noreferrer"},d=n("http://localhost:9000/ribbon-consumer"),v=n(" \u8FDB\u884C\u6D4B\u8BD5\u3002"),g=a(`<p>hello-service:8001\u548Chello-service:8002\u4EA4\u66FF\u8F93\u51FA\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>tyson<span class="token punctuation">.</span>helloservice<span class="token punctuation">.</span></span>HelloController</span>   <span class="token operator">:</span> <span class="token operator">/</span>hello<span class="token punctuation">,</span> host<span class="token operator">:</span>DESKTOP<span class="token operator">-</span><span class="token number">8F</span><span class="token number">30</span>VS1<span class="token punctuation">,</span> service_id<span class="token operator">:</span>HELLO<span class="token operator">-</span>SERVICE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2);function m(b,h){const t=c("ExternalLinkIcon");return p(),o("div",null,[u,s("p",null,[r,s("a",k,[d,l(t)]),v]),g])}var w=e(i,[["render",m],["__file","4-ribbon.html.vue"]]);export{w as default};
